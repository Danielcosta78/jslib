/* DynamicForms by danny78 JSLibs - MIT License */
document.addEventListener("DOMContentLoaded",function(){let e={pt:{required:"Este campo \xe9 obrigat\xf3rio.",email:"E-mail inv\xe1lido.",min:"M\xednimo de {0} caracteres.",max:"M\xe1ximo de {0} caracteres.",number:"Somente n\xfameros s\xe3o permitidos.",cpf:"CPF inv\xe1lido.",cnpj:"CNPJ inv\xe1lido.",match:"Os campos n\xe3o coincidem.",password:"A senha deve conter pelo menos 8 caracteres, uma mai\xfascula, uma min\xfascula e um n\xfamero.",date:"Data inv\xe1lida. Use o formato YYYY-MM-DD.",url:"URL inv\xe1lida.",cep:"CEP inv\xe1lido.",file:{required:"Selecione um arquivo.",size:"Tamanho m\xe1ximo: {0}KB",type:"Tipo de arquivo n\xe3o permitido."},regex:"Formato inv\xe1lido.",unique:"Valor j\xe1 est\xe1 em uso."},en:{required:"This field is required.",email:"Invalid email address.",min:"Minimum {0} characters.",max:"Maximum {0} characters.",number:"Only numbers are allowed.",cpf:"Invalid CPF.",cnpj:"Invalid CNPJ.",match:"Fields do not match.",password:"Password must contain at least 8 characters, one uppercase, one lowercase and one number.",date:"Invalid date. Use YYYY-MM-DD format.",url:"Invalid URL.",cep:"Invalid ZIP code.",file:{required:"Please select a file.",size:"Maximum size: {0}KB",type:"File type not allowed."},regex:"Invalid format.",unique:"Value is already in use."},es:{required:"Este campo es obligatorio.",email:"Correo electr\xf3nico inv\xe1lido.",min:"M\xednimo {0} caracteres.",max:"M\xe1ximo {0} caracteres.",number:"Solo se permiten n\xfameros.",cpf:"CPF inv\xe1lido.",cnpj:"CNPJ inv\xe1lido.",match:"Los campos no coinciden.",password:"La contrase\xf1a debe contener al menos 8 caracteres, una may\xfascula, una min\xfascula y un n\xfamero.",date:"Fecha inv\xe1lida. Use el formato YYYY-MM-DD.",url:"URL inv\xe1lida.",cep:"C\xf3digo postal inv\xe1lido.",file:{required:"Seleccione un archivo.",size:"Tama\xf1o m\xe1ximo: {0}KB",type:"Tipo de archivo no permitido."},regex:"Formato inv\xe1lido.",unique:"El valor ya est\xe1 en uso."}},a={framework:"default",lang:document.documentElement.lang||"pt",classes:{default:{error:"input-error",success:"input-success",errorMessage:"error-message"},bootstrap:{error:"is-invalid",success:"is-valid",errorMessage:"invalid-feedback"},tailwind:{error:"border-red-500",success:"border-green-500",errorMessage:"text-red-500 text-sm mt-1"}}},t=document.querySelectorAll("form[data-validate]");async function r(e,a){let t=!0,r=e.querySelectorAll("[data-rule]");for(let s of r){let l=await i(s,e,a);l||(t=!1)}return t?e.dispatchEvent(new CustomEvent("validation:valid")):e.dispatchEvent(new CustomEvent("validation:invalid")),t}async function i(e,a,t){let{error:r,success:i,errorMessage:o}=t.classes[t.framework],c=e.dataset.rule.split("|"),d=e.value.trim(),u=e.nextElementSibling,m=!0,p="";for(let _ of c){let[f,v]=_.split(":"),$=s(f,v,t.lang);switch(f){case"required":d||(p=$,m=!1);break;case"email":/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d)||(p=$,m=!1);break;case"min":d.length<parseInt(v)&&(p=$.replace("{0}",v),m=!1);break;case"max":d.length>parseInt(v)&&(p=$.replace("{0}",v),m=!1);break;case"number":/^\d+$/.test(d)||(p=$,m=!1);break;case"cpf":l(d)||(p=$,m=!1);break;case"cnpj":n(d)||(p=$,m=!1);break;case"match":let g=a.querySelector(`[name="${v}"]`);g&&g.value!==d&&(p=$,m=!1);break;case"password":/(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}/.test(d)||(p=$,m=!1);break;case"date":/^\d{4}-\d{2}-\d{2}$/.test(d)||(p=$,m=!1);break;case"url":/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/.test(d)||(p=$,m=!1);break;case"cep":/^\d{5}-?\d{3}$/.test(d)||(p=$,m=!1);break;case"file":let h=e.files[0],b=1024*v,y=e.dataset.fileTypes?e.dataset.fileTypes.split(","):["image/jpeg","image/png","application/pdf"];h?h.size>b?(p=$.size.replace("{0}",v),m=!1):y.includes(h.type)||(p=$.type,m=!1):(p=$.required,m=!1);break;case"regex":let k=RegExp(v);k.test(d)||(p=$,m=!1);break;case"unique":let w=v;try{let q=await fetch(`${w}?value=${d}`).then(e=>e.json());q||(p=$,m=!1)}catch(E){console.error("Validation error:",E),p="Erro na valida\xe7\xe3o.",m=!1}}if(!m)break}return m?(u.textContent="",u.style.display="none",e.classList.remove(r),e.classList.add(i)):(u.textContent=p,u.style.display="block",u.className=o,e.classList.add(r),e.classList.remove(i)),m}function s(a,t,r){let i=e[r]||e.pt;return"file"===a?i.file:i[a]||`Validation failed for rule: ${a}`}function l(e){if(11!==(e=e.replace(/[^\d]+/g,"")).length||/^(\d)\1+$/.test(e))return!1;let a=0,t;for(let r=1;r<=9;r++)a+=parseInt(e[r-1])*(11-r);if((10==(t=10*a%11)||11===t)&&(t=0),t!==parseInt(e[9]))return!1;a=0;for(let i=1;i<=10;i++)a+=parseInt(e[i-1])*(12-i);return(10==(t=10*a%11)||11===t)&&(t=0),t===parseInt(e[10])}function n(e){if(14!==(e=e.replace(/[^\d]+/g,"")).length||/^(\d)\1+$/.test(e))return!1;let a=e.length-2,t=e.substring(0,a),r=e.substring(a),i=0,s=a-7;for(let l=a;l>=1;l--)i+=t.charAt(a-l)*s--,s<2&&(s=9);let n=i%11<2?0:11-i%11;if(n!=r.charAt(0))return!1;a+=1,t=e.substring(0,a),i=0,s=a-7;for(let o=a;o>=1;o--)i+=t.charAt(a-o)*s--,s<2&&(s=9);return(n=i%11<2?0:11-i%11)==r.charAt(1)}t.forEach(e=>{let t={...a,framework:e.dataset.framework||a.framework,lang:e.dataset.lang||a.lang},{error:s,success:l,errorMessage:n}=t.classes[t.framework];(function e(a){a.querySelectorAll("[data-mask]").forEach(e=>{let a=e.dataset.mask;e.addEventListener("input",e=>{let t=e.target.value.replace(/\D/g,"");"cpf"===a?t=t.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4"):"cnpj"===a?t=t.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/,"$1.$2.$3/$4-$5"):"cep"===a?t=t.replace(/(\d{5})(\d{3})/,"$1-$2"):"phone"===a?t=t.replace(/(\d{2})(\d{4,5})(\d{4})/,"($1) $2-$3"):"date"===a&&(t=t.replace(/(\d{4})(\d{2})(\d{2})/,"$1-$2-$3")),e.target.value=t})})})(e),e.addEventListener("submit",async function(a){let i=await r(e,t);i||a.preventDefault()}),e.addEventListener("reset",()=>{(function e(a,t){let{error:r,success:i,errorMessage:s}=t.classes[t.framework];a.querySelectorAll(`.${r}, .${i}`).forEach(e=>{e.classList.remove(r,i)}),a.querySelectorAll(`.${s}`).forEach(e=>{e.textContent="",e.style.display="none"}),a.dispatchEvent(new CustomEvent("validation:reset"))})(e,t)});let o=e.querySelectorAll("[data-rule]");o.forEach(a=>{a.addEventListener("blur",()=>i(a,e,t)),a.addEventListener("input",()=>{a.classList.contains(s)&&i(a,e,t)})})})});
